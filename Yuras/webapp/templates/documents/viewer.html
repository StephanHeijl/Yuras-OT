{% extends "layout/viewer.html" %} {% block index %}
<svg id="annotation-connector"></svg>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="navbar-header">
		<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
			<span class="sr-only">{{ _("Toggle navigation") }}</span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		</button>
		<a class="navbar-brand" href="#" id="document-title">{{ document.title }}</a>
	</div>

	<!-- Collect the nav links, forms, and other content for toggling -->
	<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		<ul class="nav navbar-nav">
			<div id="csrf-token" data-csrf={{ csrf_token() }}></div>

			<!--
			<li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">File <span class="caret"></span></a>
				<ul class="dropdown-menu" role="menu">
					<li><a href="#" id="new-document">New</a>
					</li>
					<li><a href="#" id="open-document">Open</a>
					</li>
					<li><a href="#" id="save-document" data-csrf={{ csrf_token() }}>Save</a>
					</li>
					<li class="divider"></li>
					<li><a href="#" id="secure-document" data-csrf={{ csrf_token() }}>Secure document</a>
					</li>
					<li class="divider"></li>
					<li><a href="/documents">Exit</a>
					</li>
				</ul>
			</li>
			-->

			<!--
			<li>
				<a href="#" id="back"><span class="glyphicon glyphicon-chevron-left"></span> Back</a>
			</li>
			-->

			<li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">{{ _("Download as") }} <span class="caret"></span></a>
				<ul class="dropdown-menu" role="menu">
					<li><a href="{{ document._id }}/download/docx">{{ _("Word Document") }}</a>
					</li>
					<li><a href="{{ document._id }}/download/pdf">PDF</a>
					</li>
					<li><a href="{{ document._id }}/download/txt">{{ _("Plain text") }}</a>
					</li>
				</ul>
			</li>
<!--
			<li>
				<a href="#" id="analyze-document" data-csrf={{ csrf_token() }}><span class="glyphicon glyphicon-eye-open"></span> {{ _("Analyze document") }}</a>
			</li>

			<li>
				<a href="#" id="get-related" data-csrf={{ csrf_token() }} data-toggle="modal" data-target="#relatedModal"><span class="glyphicon glyphicon-search"></span> {{ _("Get related documents") }}</a>
			</li>
			
			<li lass="related-document-add">
				<a href="#"><div class="glyphicon glyphicon-plus"></div> {{ _("Add to latest case") }}</a>
			</li>
-->

		</ul>

		<ul class="nav navbar-nav pull-right">
			<li>
				<a href="javascript:history.back();" id="back"><span class="glyphicon glyphicon-chevron-left"></span>{{ _("Back") }}</a>
			</li>
		</ul>
	</div>
	<!-- /.navbar-collapse -->
</nav>

<div class="annotation-wrapper">
	<div class="annotation-wrapper-padding">
		<div class="category-container">
			<div class="category-dropdown btn btn-lg btn-default dropdown-toggle" data-toggle="dropdown" data-value="">
				<span id="category">{{ document.category|replace("_"," ") if document.category is not none and document.category is not undefined else _("Category") }}</span>
				<span class="caret"></span>
			</div>
			<ul class="dropdown-menu" role="menu">
				{% for category in categories %}
				<li role="presentation">
					<a role="menuitem" tabindex="-1" href="#" class="category-menu-option">{{category.name|replace("_"," ")}}</a>
				</li>
				{% endfor %}
				<li class="divider"></li>
				<li role="presentation">
					<a role="menuitem" tabindex="-1" href="#" id="create-new-category">{{ _("New category") }}</a>
				</li>
			</ul>

		</div>

		<br/>

		<div class="input-group input-group-lg">
			<input type="text" class="form-control" placeholder="{{ _("Search") }}">
			<span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span>
		</div>

		<br/>

		<div class="annotation-page">
			{% for annotation in annotations %}
			<div class="annotation" data-selected_text="{{ annotation.selected_text }}" data-annotation-id="{{ annotation._id }}" data-location="{{ annotation.location[0]}},{{ annotation.location[1]}}" data-linked-to="{{ annotation.linked_to }}">
				{{annotation.contents | safe}}
			</div>
			{% endfor %}

		</div>
		<div class="annotation-spacer" style="width:100%;height:100%;"></div>
	</div>
</div>
<div class="document-wrapper">
	<div class="document">
		<div class="document-content">
			<div class="document-content-padding">
				<div class="document-body markdown">
					{{document.contents|safe}}
				</div>
			</div>
		</div>
	</div>

	<!-- Modal -->
	<div class="modal fade" id="relatedModal" tabindex="-1" role="dialog" aria-labelledby="relatedModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
					</button>
					<span class="modal-title" id="relatedModalLabel">{{ _("Related documents") }}</span> 
					{% if cases|length > 0 %}
					<div class="dropdown pull-right" style="margin-right: 20px; margin-top: -5px;">
						<div class="case-dropdown btn btn-default dropdown-toggle" data-toggle="dropdown" data-value="">
							<span id="chosen-case" data-case-id="{{ cases[-1]._id }}">{{ cases[-1].title }}</span>
							<span class="caret"></span>
						</div>
						<ul class="dropdown-menu" role="menu">
							{% for case in cases %}
							<li role="presentation">
								<a role="menuitem" tabindex="-1" href="#" class="case-menu-option" data-case-id="{{case._id}}">{{case.title}}</a>
							</li>
							{% endfor %}
						</ul>
					</div>
					{% endif %}
				</div>
				<div class="modal-body">
					<div class="container-fluid">
						<div class="case-document" style="display:none;">
							{% if cases|length > 0 %}
							<div class="related-document-add">
								<div class="glyphicon glyphicon-plus"></div>
							</div>
							{% endif %}
							<div class="document-item" data-type="{{document.document_type}}" data-id="{{ document._id }}">
								<div class="document-summary">
									{% if document.markedContents|length > 0 %}
									{{ "...".join(document.markedContents[:5])|safe }}
									{% endif %}
								</div>
								<div class="file-icon" draggable="true">
									<div class="file-icon-fold"></div>
									<div class="file-icon-fold-cover"></div>

									{% if document.document_type == "jurisprudence" %}
									<div class="file-icon-image gavel"></div>
									{% endif %}
									{% if document.document_type == "law" %}
									<div class="file-icon-image"><span class="glyphicon glyphicon-star"></span></div>
									{% endif %}

									<div class="file-icon-badge case-document-score">
										{{ document.score }}
									</div>
								</div>
								<span class="case-document-title"></span>
							</div>
							
						</div>
						<img class="related-loader" src="/assets/img/loader.gif">>
						<div class="row">

						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default">{{ _("Select all") }}</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal">{{ _("Close and add selected") }}</button>
				</div>
			</div>
		</div>
	</div>

	{% endblock %}